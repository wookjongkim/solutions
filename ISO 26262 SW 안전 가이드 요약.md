## 배경
차량의 기능 및 운행 제어에 대한 전자시스템 및 SW에 대한 의존성이 높아지고 차량 내부 통신망이 발달함에 따라 `비 기계적 요소에 의한 차량의 안전 저해 가능성이 높아진 상황`<br>
-> 이러한 기술적 변화에 따라 차량에 탑재되는 전기전자시스템의 안전을 확보하기 위한 새로운 개발 패러다임으로 `기능 안전(Functional Safety)` 개념이 차량 전자제어 시스템 개발에 적용되고 있음<br>
<br>
기능안전 모표준인 `IEC 61508`을 근간으로 2011년 `ISO 26262`를 제정<br>
-> 전세계 완성차 제조사(OEM)와 부품사가 참여하여 개발되었으며, 전 세계 주요 OEM은 기능안전을 확보한 시스템 개발을 위해 ISO 26262에 대한 요구사항을 포함하여 부품사에게 부품 개발을 요구하고 있음<br>
-> 이를 위해 OEM은 기능안전요구사항과 이들의 ASIL(Automotive Safety Integrity Level, 자동차 안전 무결성 등급)을 정의하고 부품사들이 이에 따라 ISO 26262 표준을 준수하여 제품을 개발하여 공급하도록 요구<br>
<br>
ISO 26262는 기능안전 확보를 위한 기법과 목표 기준만을 제시하고, 구체적인 도구와 방법은 제시하지 않음<br>
-> 큰 기업의 경우엔 문제가 없지만, 국내 중소 SW 기업들의 경우 자체적으로 표준을 해석하는데 어려움<br>
<br>
`갈수록 하드웨어 oriented 되어 있는 분야에서 sw에 대한 의존도가 높아지고 있음` <br>
-> 하드웨어 장치 중심의 기능 오작동에 대한 대응만으로는 전체적인 기능 안전을 확보할 수 없게 됨. 기능 안전에서 소프트웨어 안전의 역할과 중요성이 커지고 있음<br>
<br>

---

## 자동차 SW 특징
자동차는 순수 기계장치로 탄생했지만, 현재 자동차 회사들은 기계 기술로 해결하지 못하는 안전, 환경 규제와 사용자 편의성 제공위해 전기전자 기술과 소프트웨어 기술을 적극적으로 사용<br>
-> ex) 차선 유지 보조, 자동 긴급 제동 시스템과 같은 ADAS(첨단 운전자 보조) 시스템은 모두 SW로 구현됨<br>
<br>
고속으로 운행하는 자동차의 특성 상, 제어 소프트웨어의 오작동이 치명적인 손실로 이어질 수 있다.<br>
-> 네비게이션과 같은 인포테인먼트 SW의 경우도 간접적으로 운전자를 방해할 수 있기에 세심한 설계 필요함<br>
<br>
자동차 SW은 일반적인 SW와 다르게 `제어기에 내장되어 있기 때문에` 부품의 일부로 동작하고 사용자의 눈에 보이지 않는 특징을 가짐<br>
-> 정상 동작 여부를 확인하기 어렵고 검증에 많은 노력과 시간이 필요<br>
<br>

`산업 구조 측면에서 자동차 SW는 완성차 회사 혹은 부품사(Tier-N)의 발주에 의해 맞춤형으로 개발되는 경우가 대부분` <br>
-> 비슷한 기능을 하는 SW의 경우에도 `차종과 연식별로 상이한 요구사항`을 가지고 있기 때문, SW 개발사는 이에 유연하게 대응해야 함<br>
-> 자주 변하는 요구사항에 잘 대응해야 하고, 안전도 확보해야 함<br>
<br>

자동차 SW 개발 측면에서도 소스 코드를 개발자가 직접 작성하지 않고 다이어그램 형태의 모델로부터 자동 생성해서 사용하는 `MBD(Model Based Design)` 방법을 많이 사용<br>
고속으로 움직이는 자동차에 연결되어 동작하기에 동작을 멈추고 디버깅하는 방식을 사용할 수도 없음 -> 자동차 SW 개발 분야가 대단히 독특한 분야임을 반증<br>
<br>

---

## 자동차 SW 분류
자동차에 탑재되는 SW는 크게 `IVI(In-Vehicle infotainment)` 시스템을 위한 SW와 `차량 제어 시스템`을 위한 소프트웨어로 구분할 수 있다<br>

- `IVI` : 오디오,비디오 같은 멀티미디어 기능과 GPS 네비게이션 등을 포함
- `차량제어 시스템` : 엔진, 조향장치, 제동장치와 같이 자동차의 움직임을 제어하는 기계 부품들과 연결되어 동작

차량제어 시스템이 더 높은 수준의 안전 요구사항을 필요로 함<br>
멀티미디어 기능의 경우 상대적으로 낮은 안전 요구사항을 가지는 반면, 인스트루먼트 클러스터(Instrument Cluster)의 경우 더 높은 안전이 요구되고 제동 장치를 제어하는 제어기는 훨씬 높은 안전이 요구됨<br>

차량 제어 시스템은 크게 `파워트레인(Powertrain)`, `샤시(Chassis)`, `바디(Body)` 도메인으로 나뉜다<br>

- `파워트레인` : 엔진이 생성한 동력을 바퀴로 전달하여 자동차가 움직이게 만드는 시스템입니다.(엔진, 변속기와 같은거)
- `샤시` : 자동차의 차체를 뺀 나머지 부분으로 주행의 원동력이 되는 엔진을 비롯하여 동력 전달장치, 조향장치, 현가장치, 제동 장치 등이 있습니다.
- `바디` : 자동차의 기계부품과 승객을 보호하도록 설계된 자동차의 외관 구조물을 지칭함

### 각 도메인에서 사용되는 SW
파워트레인의 경우 `EMS`(Engine Management System : 엔진을 제어하는 시스템), `TMS`(Transmission Management System : 변속기 제어 시스템)를 중요한 구성 요소로 포함<br>
샤시 도메인의 경우 횡방향 안정성 강화하는 `ESC(Electronic Stability Control)`

---

## 자동차 SW 구조
자동차 SW 중 AVN(Audio, Video, and Navigation)시스템의 경우 응용 SW와 유사한 구조<br>
-> 차량 제어 SW의 경우에는 일반적인 모바일 or PC 소프트웨어와 전혀 다른 구조를 가지고 있어야 함<br>
<br>
원래 차량 제어 소프트웨어의 구조는 회사별로 독자적으로 발전해 옴<br>
-> 이러한 배경에서 자동차 SW의 재사용성을 높이고, 응용 소프트웨어에 영량을 집중하기 위해 `AUTOSAR(Automotive Open System Architecture)`라는 자동차 제어 표준을 만듬<br>
<br>
![image](https://github.com/wookjongkim/solutions/assets/121083077/f179a10b-2c5f-46a4-984a-818b70bec96a)
하드웨어 위에 표준화된 BSW(Basic Software) 계층, RTE 계층을 올려서 그 위에서 동작하는 ASW는 AUTOSAR 표준에 맞춰서 개발되면 하드웨어가 변경되더라도 호환성을 유지할 수 있음<br>
<br>
AUTOSAR는 영상처리, 인공지능, Connectivity, OTA(Over the Air) 등 최신 분야에 대한 기술 지원이 안됨<br>
-> 이에 대한 대응으로 리눅스와 같은 POLSIX 표준에 따르는 운영체제를 가정한 새로운 AUTOSAR 표준인 `Adaptive AUTOSAR` 표준이 2017년 발표<br>
<br>

---

## 자동차 sw 관련 산업구조
완성차 회사(OEM)을 정점으로 부품사(Tier-N)들이 협력하는 피라미드 구조를 가짐<br>

![image](https://github.com/wookjongkim/solutions/assets/121083077/14bd73f8-baec-4050-9848-c76fde278ff6)
완성차 회사에 직접 부품을 공급하는 회사를 Tier-1이라 하고, Tier-1에 부품을 공급하는 회사를 Tier-2라고 함<br>
<br>

자동차 SW 기술은 부품사들을 중심으로 발전해 옴<br>
-> 독일의 거대 부품사들은 오랜 기간 동안 SW개발 경험을 바탕으로 AUTOSAR, ISO 26262, Automotive SPICE 등 자동차 소프트웨어 관련 막대한 영향력<br>
<br>
자동차 SW는 부품사와 그 협력사에 의해 개발되어 완성차 회사에 부품, 모듈, 시스템 형태로 납품되는 경우가 대부분<br>

---

## ISO 26262
![image](https://github.com/wookjongkim/solutions/assets/121083077/fc19d298-011c-4ea8-a012-463d97085dd9)

IEC 61508에서 파생된 표준으로 2011년에 발표된 자동차 전기전자 시스템을 위한 기능안전 표준입니다.(3.5톤 이하 양상 승용차만을 대상으로 함)<br>
<br>
보통 완성차 회사에서 안전 분석을 하여 어느 정도의 안전 등급을 유지해야 하는지 결정하고, 이에 따라 부품사는 등급별로 ISO 26262에 명시된 의무사항을 수행하고, 결과를 완성차 회사에 제출해야 함<br>
<br>
MISRA는 자동차 소프트웨어의 안전 확보를 위해 발표된 표준<br>
-> 처음에는 자동차를 타겟으로 하였지만, 지금은 항공 철도 국방 등 다양한 분야에서도 많이 사용되는 중<br>
<br>


---

## A-SPICE
![image](https://github.com/wookjongkim/solutions/assets/121083077/7d223e1d-ca17-4da8-880c-be2ab352b137)

Automotive SPICE(A-SPICE)는 ISO/IEC 15504 및 ISO/IEC 12207을 기반으로 자동차 임베디드 시스템 개발에 맞게 특화하여 만든 국제 표준 프로세스 참조 및 평가 모델입니다.<br>
<br>
자동차에서 소프트웨어의 비중이 커져가면서 SW 개발에 대한 신뢰성을 확보하기 힘들다는 완성차 회사들의 판단으로 자동차 소프트웨어 개발 프로세스의 정립 및 평가가 필요했음<br>
-> 이때 CMMI나 SPICE와 같은 기존 프로세스 모델을 도입하여 해결 하고자 했음<br>
<br>
독일 자동차 협회(VDA)에서 라이센스 비용, 변경 용이성 고려해서 2005년 SPICE 기반으로 A-SPICE 1.0 발표<br>
<br>
많은 완성차 회사들, 특히 독일 자동차 협회를 중심으로 한 회사들은 Tier-1 부품사에게 필수적으로 A-SPICE 레벨 2~3을 유지하도록 강하게 요구하고 있<br>
<br>

---

## ASIL 등급 분류

![image](https://github.com/wookjongkim/solutions/assets/121083077/6ab1ad96-9ffe-4ef7-ab04-91a31aaf054a)

---

## SW 안전 개발 기준 단계 모델(V모델)

![image](https://github.com/wookjongkim/solutions/assets/121083077/8822c2d1-7774-47f9-b922-250ec8cc6406)

---

## MIL(Model In the Loop), SIL(SW In the Loop), PIL(Precessor In the Loop)
![image](https://github.com/wookjongkim/solutions/assets/121083077/5248ca63-7696-4814-98eb-e16b86acbd24)

MIL에서 PIL로 갈수록 시뮬레이션 결과가 실제 제어기 환경에 가까워짐

- `MIL` : 제어 대상과 제어기가 모두 PC에서 개발된 그래픽 모델을 이요하여 시뮬레이션 됨
- `SIL` : 제어 대상은 MIL 방법과 동일하나, 제어기 모델은 코드가 생성되어 PC에서 컴파일 된 후 실행됨
- `PIL` : 제어 코드가 임베디드 보드에서 실행됨

---

## HIL(Hardware-In-the-Loop)
ECU를 검증할때 가장 정확한 방법은 ECU를 완성된 차량에 직접 연결하여 테스트하는 것<br>
-> 하지만 검증 초기 단계에 실차를 이용할 경우 실차 준비전 테스트 불가, ECU 오동작이 실험 인원에 위험초래할 수도<br>
<br>
따라서 효율적인 ECU 초기 검증을 수행하기 위해 개발 됨<br>
<br>
HIL 테스트 환경은 검증 대상 ECU와 HIL 시뮬레이터로 구성되어 있음<br>
-> HIL 시뮬레이터는 물리 시스템 즉 실차를 모사하는 가상 환경 제공, 여기 연결된 ECU는 실차에 연결된 것 같은 입출력 시그널을 주고받게 됨 <br>
-> 예를들어 엔진 ECU를 테스트할때는 연료분사, 폭발, 배기와 같은 엔진의 물리적인 움직임을 모사하는 엔진 HIL 시뮬레터 사용됨<br>
-> 시뮬레이션 환경이기 때문에 위험하거나 드물게 발생하는 경우의 수를 만들어 테스트 가능<br>
<br>
ECU는 독자적으로 동작하는 경우가 드물고 다른 ECU들과 협조하면서 동작핳는 경우가 많음(ex: 다른 ECU의 도움 없이는 테스트케이스 실행이 불가능한 경우도 있다)<br>
<br>

---

## 관련 질문

<details markdown = "1">
<summary>ASIL(Automotive Safety Integrity Level)이란?</summary>
ASIL은 자동차 안전 무결성 수준을 의미하며 HARA(Hazard Analysis and Risk Assessment, 일종의 평가 지표)를 통해서 값이 정해집니다.<br>
ISO 26262 준수를 위한 핵심 사항으로서, A~D등급으로 나뉩니다. 이때 D등급으로 갈수록 안전이 중요한 프로세스라는 뜻입니다.(D등급의 경우 조향, 브레이크 등등)<br>
<br>
해당 시스템에 의해 발생할 수 있는 위험요소의 심각도, 노출 가능성 및 제어 가능성에 따라 ASIL 등급이 매겨짐<br>
</details>

<details markdown = "1">
<summary>Functional Safety(기능안전)이 무엇인지?</summary>
기능 안전은 안전 확보를 위해 하나 이상의 자동 보호 기능을 구현하여 사람의 신체적 상해 및 건강 손상을 발생시키는 위험을 대응하는 것<br>
</details>

<details markdown = "1">
<summary>ADAS(Advanced Driver Assistance System), By-Wire Systems, Active Systems, ESC(Electronic Stability Control)</summary>

`ADAS`: 여러 개의 센서로 차량 주변의 정보를 획득하여 위험 상황이 발생하면 자동으로 제동을 걸거나 전방 차량과의 간격을 일정하게 유지하는 등 운전자의 안전운전을 보조해 주는 시스템<br>
By-Wire System : 물리적 연결 대신 전기 신호를 통해서 다양한 기능을 수행하는 것<br>
Active Systems : 차량의 안전성과 성능을 향상시키기 위한 시스템(ex: 더 나은 핸들링과 안정성을 위한 기능)<br>
ESC(전자식 안정성 제어 시스템) : 차량의 미끄러짐을 방지하고 방향 제어 능력을 유지할 수 있도록 돕는 기술<br>
</details>

<details markdown = "1">
<summary>파워트레인이 무엇인가?</summary>
동력을 생성하고 이를 바퀴에 전달하는 역할을 하는 도메인입니다.(엔진, 변속기)<br>
<br>
엔진을 제어하는 컴퓨터인 EMS(Engine Management System)과 자동변속기를 제어하는 컴퓨터인 TMS(Transmission Management System)을 중요한 구성 요소로 포함<br>
</details>

<details markdown = "1">
<summary>샤시는 무엇인가?</summary>
자동차의 차체를 뺀 나머지 부분으로 주행의 원동력이 되는 엔진을 비롯하여 동력 전달장치, 조향장치, 현가장치, 제동 장치 등이 있습니다<br>
<br>
현가 장치 : 차량에서 차륜과 차체를 연결하는 장치로 노면충격의 흡수와 타이어 접지력을 확보하는 역할을 합니다.<br>
샤시 도메인의 경우 차량의 횡 방향 안전성을 강화하는 ESC(Electronic Stability Control) 시스템이 대표적<br>
-> 차량이 코너에 진입했을때 오버스티어나 언더스티어가 발생하여 원하는 곡률로 회전이 되지 않는 경우 개별 바퀴의 브레이크를 독립적으로 제어하여 횡방향 안전성을 확보하는 시스템<br>
</details>

<details markdown = "1">
<summary>바디는 무엇인가?</summary>
자동차의 기계부품과 승객을 보호하도록 설계된 자동차의 외관 구조물로, 도어, 윈도우, 와이퍼 등이 있습니다<br>
</details>

<details markdown = "1">
<summary>바디는 무엇인가?</summary>
자동차의 기계부품과 승객을 보호하도록 설계된 자동차의 외관 구조물로, 도어, 윈도우, 와이퍼 등이 있습니다<br>
</details>

<details markdown = "1">
<summary>autosar(Automotive Open System Architecture)가 무엇인가?</summary>
오토사는 자동차 도메인에서 표준화된 소프트웨어 아키텍처를 뜻합니다.<br>
기본 구조는 하드웨어 위에서 표준화된 BSW(Basic Software) 계층과 RTE(Runtime Environment)계층, 그리고 RTE 계층 위에서 동작하는 ASW(Application Software)로 구성되어 있습니다.<br>
이러한 AUTOSAR 표준에 맞춰 개발되면 하드웨어가 변경되더라도 호환성을 유지할 수 있고, ASW 계층에서 소프트웨어 컴포넌트 간의 통신 방향도 표준화 되어있기에 SW 컴포넌트 또한 독립적으로 사용 가능합니다.<br>
<br>
차량 제어 소프트웨어의 구조는 회사별로 독자적으로 발전해 옴 -> 이러한 시대에서 통합적인 아키텍처인 오토사가 등장<br>
<br>
ASW는 가상의 통신방식인 VFB(Virtual Function Bus)로 연결된 여러개의 소프트웨어 컴포넌트의 집합으로 설계됨<br>
컴포넌트 구현시에는 같은 ECU에 배치되거나 서로 다른 ECU에 배치될 수가 있고, 각 경우에 대해 VFB는 자동생성되는 RTE 코드로 구현됨<br>
<br>
AUTOSAR의 운영체제는 우선순위 기반 스케쥴링을 이용하는 실시간 운영체제(고정 우선순위)<br>
우선순위 역전이나 데드락을 방지하기 위해 PCP(Priority Ceiling Protocol) 사용<br>
</details>

<details markdown = "1">
<summary>MISRA(Motor Industry Software Reliability Association)에 대해 설명해주세요.</summary>
미즈라는 영국의 자동차 공업 협회에서 자동차 전장(전자 장비)시스템의 SW를 개발하기 위해 정한 코딩 구현 표준입니다.<br>
-> 자동차에 내장된 SW의 복잡도가 증가함에 따라, 버그 발생 확률이 높아지며 이는 치명적인 결과를 야기할 수 있음.(치명적인 결과를 막기 위해 표준 발표)<br>
</details>

<details markdown = "1">
<summary>ISO-26262가 무엇이냐?</summary>
IEC 61508에서 파생된 표준으로 2011년에 발표된 자동차 전기전자 시스템을 위한 기능안전 표준입니다.(3.5톤 이하 양상 승용차만을 대상으로 함)<br>
총 10개의 파트로 구분되어 있으며, 여기에는 용어 정의부터 시작하여 안전분석, 하드웨어, 소프트웨어 개발, 양산 후 안전 관리까지 제품의 전체 생명주기에 대해서 기능 안전을 확보하기 위한 표준입니다.<br>
SW만의 표준이 아니라, HW와 SW(part 6에서 다룸)를 포괄하는 시스템을 위한 표준<br>
<br>
보통 OEM에서 안전분석을 통해 어느 정도의 안전 등급을 유지해야 하는지 결정하고, Tier회사는 해당 등급별로 ISO 26262에 명시된 의무사항들을 수행하고 그 결과를 완성차 회사에 제출해야 합니다.<br>
<br>
SW 개발의 경우 `개발 단계별 검증활동을 수행할 수 있도록 V 모델을 따름`<br>
<br>
개념단계 -> 제품 개발 -> 생산 -> 운영 -> 서비스 및 폐기 단계로 나뉨<br>

- `개념 단계` 에서는 아이템의 정의, 위험원 분석 및 위험 평가를 수행합니다. 이 과정에서 ASIL 레벨을 산정합니다. 산정 시 시나리오를 통해 사고의 노출도, 인체에 미치는 심각도, 사고를 통제할 수 있는 통제도에 의해 결정됨. 위험원 분석 및 위험 평가는 시나리오나 부품들의 상호작용에 따라 달라지므로, OEM에서 수행하는 것이 효과적. ASIL 등급과 함께 안전 목표, 기능안전 요구사항이 도출되면 ASIL 등급을 기준으로 안전 개발 활동이 수행됨.
- `제품 개발` 에서는 시스템 수준 개발, 하드웨어 수준 개발, 소프트웨어 수준 개발에 따라서 아이템이 개발됨. 개발된 아이템은 안전 타당성 확인과 기능안전 평가를 통해서 양산에 적용되도록 배포됩니다.
- 생산을 위한 배포 이후 단계는 아이템 개발이 완료된 후 생산, 운영, 서비스 및 폐기 활동을 수행함<br>
<br>

`정적 분석`에는 코딩 규칙 준수(MISRA-C), 코드 복잡도 검증(Code Metric), 런타임(RTE) 오류 분석이 있다.<br>
`동적 시험`에는 단위 테스트와 통합테스트가 있고 `모델 검증`에는 제어사양/제어모델/생성코드의 정합성 검증(MIL/SIL)이 있다.<br>
`통합 시스템 검증`(HIL 검증) -> 성능 및 장애 테스트, 안전성 테스트를 진행<br>
-> 1,3은 정적검증, 2,4는 동적 검증<br>
<br>
실행 중 발생 가능한 오류에 대해 정적 분석 기법으로 RTE 검증 수행<br>
-> 메모리,연산 등의 제어기에 치명적 영향을 줄 수 있는 오류에 대해 검증<br>

</details>

<details markdown = "1">
<summary>Automotive Spice가 무엇인가??</summary>
A-Spice는 (ISO/IEC 15504 및 ISO/IEC 12207을 기반으로) 자동차 임베디드 시스템 개발에 맞게 특화하여 만든 국제 표준 프로세스 참조 모델 및 평가 모델입니다.<br>
<br>
자동차 SW 개발에 대한 신뢰성을 확보하기 힘들다는 OEM 회사들의 판단을 바탕으로 자동차 SW 개발 프로세스의 정립 및 평가가 필요한 상황속에서 발표된 표준<br>
독일 자동차 협회(Verband Der Automobilindustrie)에서 발표하였음<br>
2005년 처음 1.0 버전이 발표되었고, 2015년에 발표된 3.0의 경우 기존의 Sw 엔지니어링만 고려한 SPICE의 한계를 넘어 시스템 엔지니어링 영역이 추가되었음<br>
  
모든 참조와 링크 간의 추적성을 강화하여 커버리지 분석(coverage analysis), 영향도 분석(impact analysis), `요구사항 기반의 구현 상태 추적`을 가능하게 하였음<br>
<br>
A-SPICE는 소프트웨어 개발에서 수행해야 하는 프로세스에 대한 `참조 모델(PRM : Process Reference Model)`과 이를 평가할 수 있는 `측정 모델(PAM : Process Assessment Model)`을 제시함<br>
PRM은 3개의 라이프 사이클 카테고리, 7개의 프로세스 군, 32개의 프로세스로 구성됨<br>
평가 측정 모델은 프로세스를 수행하는 능력의 정도를 측정하는 지표<br>
-> 레벨 0부터 5까지 있으며, 5로 갈수록 표준에 맞춰 프로세스가 잘 진행되고 있다는 의미<br>
<br>
많은 OEM들은 Tier-1 부품사에게 필수적으로 A-Spice 레벨 2~3을 유지하도록 강하게 요구하는 추세<br>
</details>



































